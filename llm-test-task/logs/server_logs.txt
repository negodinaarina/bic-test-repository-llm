2025-09-11 00:08:59,044 - INFO - OK | GET /models | handler=get_models_names | time=0.4200s | status_code=200
2025-09-11 00:09:14,590 - INFO - OK | GET /models | handler=get_models_names | time=0.4693s | status_code=200
2025-09-11 00:10:54,423 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=62.1981s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/api/endpoints.py", line 14, in post_model_prompt
    response = await open_router_client.post_prompt(prompt)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/openrouter/client.py", line 25, in post_prompt
    r = await self._post(url="/completions", json={
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 64, in _post
    return await self._make_request(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 32, in _make_request
    response = await client.request(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1643, in send
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1637, in send
    await response.aread()
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 979, in aread
    self._content = b"".join([part async for part in self.aiter_bytes()])
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout

2025-09-11 00:12:42,258 - INFO - OK | GET /docs | handler=swagger_ui_html | time=0.0012s | status_code=200
2025-09-11 00:12:42,408 - INFO - OK | GET /openapi.json | handler=openapi | time=0.0031s | status_code=200
2025-09-11 00:16:14,155 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=63.5744s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/api/endpoints.py", line 14, in post_model_prompt
    response = await open_router_client.post_prompt(prompt)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/openrouter/client.py", line 25, in post_prompt
    r = await self._post(url="/completions", json={
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 64, in _post
    return await self._make_request(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 32, in _make_request
    response = await client.request(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1643, in send
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1637, in send
    await response.aread()
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 979, in aread
    self._content = b"".join([part async for part in self.aiter_bytes()])
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout

2025-09-11 00:17:09,189 - INFO - OK | GET /models | handler=get_models_names | time=0.4266s | status_code=200
2025-09-11 00:18:13,750 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=39.2424s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 151, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'text'), 'msg': 'Field required', 'input': {'id': 'gen-1757539055-qyK2Sb8e6XyBg5vwd5QB', 'provider': 'DeepInfra', 'model': 'deepseek/deepseek-chat-v3.1:free', 'object': 'chat.completion', 'created': 1757539055, 'choices': [{'logprobs': None, 'finish_reason': 'stop', 'native_finish_reason': 'stop', 'text': " и его возможности в стиле Есенина', 'assistant': 'assistant', 'created_at': datetime.datetime(2023, 10, 16, 18, 54, 25, 537000), 'id': 8, 'local_id': 8, 'conversation_id': 2, 'parent': 7, 'children': [9], 'is_error': False, 'generation_info': None, 'metadata': {}}), HumanMessage(content='Напиши стих про Python и его возможности в стиле Есенина', additional_kwargs={}, example=False), AIMessage(content='Как Есенин, я попробую передать душу Python в стихах:\\n\\n**Python**\\n\\nВ саду технологий, где код цветёт,\\nСреди ветвей алгоритмов Python живёт.\\nЕго синтаксис — как тихий шепот листьев,\\nВ нём мощь сокрыта, что в мире пригодится.\\n\\nО, Python, ты прост и элегантен,\\nКак осенью клён, что золотом богат.\\nТы спишь в вечерних серверах туманах,\\nЧтоб утром мир будить свой аромат.\\n\\nТы можешь всё: от скрипта малого\\nДо искусственных разумов больших.\\nТы в Data Science стал уже признанным,\\nИ машинное обучение — твой стих.\\n\\nТы дружелюбен к тем, кто только начинает,\\nИ господин для опытных умов.\\nТы обернул в удобство все задания,\\nЧтоб каждый программист был вновь готов.\\n\\nТвои библиотеки — как поля цветущие,\\nГде каждый цветок — новый метод, класс.\\nОт Django к Flask — пути зовущие,\\nВ мир разработки, что не знает нас.\\n\\nИ пусть порой другие языки\\nШумят, как ветры в голых ветвях,\\nТы остаешься нежным и великим,\\nКак есенинская грусть в стихах.\\n\\nТак будь же, Python, вдохновеньем вечным,\\nДля тех, кто ищет истину и свет.\\nТы стал для многих и утехой, и лечением,\\nИ лучшим языком, что только есть!\\n\\nНадеюсь, этот стих передаёт простоту и элегантность Python, а также его мощь и универсальность, с лёгкой грустью и лиричностью, характерной для Есенина.', additional_kwargs={}, example=False), AIMessageChunk(content='', id='run-4e0fbb1e-4e7b-4b5f-a8f9-4b3f5b3b3b3b')]", 'reasoning': None}], 'usage': {'prompt_tokens': 7, 'completion_tokens': 661, 'total_tokens': 668, 'prompt_tokens_details': None}}}


2025-09-11 00:20:54,059 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=61.6502s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/api/endpoints.py", line 14, in post_model_prompt
    response = await open_router_client.post_prompt(prompt)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/openrouter/client.py", line 25, in post_prompt
    r = await self._post(url="/completions", json={
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 64, in _post
    return await self._make_request(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 32, in _make_request
    response = await client.request(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1643, in send
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1637, in send
    await response.aread()
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 979, in aread
    self._content = b"".join([part async for part in self.aiter_bytes()])
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout

2025-09-11 00:24:15,344 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=32.5454s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 151, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'text'), 'msg': 'Field required', 'input': {'id': 'gen-1757539423-cnCib9aXiX71QECS7tlI', 'provider': 'DeepInfra', 'model': 'deepseek/deepseek-chat-v3.1:free', 'object': 'chat.completion', 'created': 1757539423, 'choices': [{'logprobs': None, 'finish_reason': 'stop', 'native_finish_reason': 'stop', 'text': ' на русском языке."\n    },\n    {\n      "role": "assistant",\n      "content": "Конечно, вот несколько вариантов:\\n\\n**Вариант 1 (Более лиричный)**\\n\\nPython, язык прекрасный и могучий,\\nДля новичков он — лучший, нету круче.\\nОтступы в нём — не просто пробелы,\\nА целая философия и метод смелый.\\n\\nОн дружит с данными, творит нейросети,\\nВедёт сайты, решает задачки эти.\\nОт простого скрипта до науки сложной —\\nОн гибок, мощен и душою строгой.\\n\\n«Импортируй» библиотеку — и вот,\\nУже готов могучий поворот.\\nИ нет преград для смелой его мысли,\\nЧто Python задумал — всё совершили.\\n\\n**Вариант 2 (Более технический и с юмором)**\\n\\nЕсть много языков у программиста,\\nНо Python — машинный лингвист.\\nЧитается, как простая повесть,\\nНеся разработчику искренний интерес.\\n\\nНе нужны тут скобки фигурные,\\nЛишь отступы — важны и хитрые.\\n«Hello, World!» — напишешь ты вмиге,\\nИ побегут строчки по строгим дорогам.\\n\\nСписок, словарь и множества, кортежи —\\nСтруктуры данных, что нам так дороги.\\nМашинное learning и большой DataFrame —\\nВезде наш Питон становится главным.\\n\\n**Вариант 3 (Короткий)**\\n\\nУмный, простой, элегантный Python.\\nОн в сердце разработчика поселился.\\nС ним любой алгоритм становится ясным,\\nА код — читаемым и прекрасным.\\n\\nНапишешь `import this` — и вот он, дзен,\\nДля задач любых он теперь вооружён!"\n    }\n  ]\n}', 'reasoning': None}], 'usage': {'prompt_tokens': 7, 'completion_tokens': 489, 'total_tokens': 496, 'prompt_tokens_details': None}}}


2025-09-11 00:27:40,915 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=75.5537s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 151, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'text'), 'msg': 'Field required', 'input': {'id': 'gen-1757539585-iw4XVILxpcTp84MulOLH', 'provider': 'DeepInfra', 'model': 'deepseek/deepseek-chat-v3.1:free', 'object': 'chat.completion', 'created': 1757539585, 'choices': [{'logprobs': None, 'finish_reason': 'stop', 'native_finish_reason': 'stop', 'text': ' и где его применяют с юмором.\',\n        \'temperature\': 0.7,\n        \'max_tokens\': 500,\n        \'top_p\': 1.0,\n        \'frequency_penalty\': 0.0,\n        \'presence_penalty\': 0.0,\n        \'stop\': [\'\\n\']\n    }\n    try:\n        response = openai.Completion.create(**params)\n        return response.choices[0].text.strip()\n    except Exception as e:\n        return f"Ошибка при генерации стиха: {str(e)}"\n\ndef generate_image(prompt):\n    """Генерирует изображение по текстовому описанию"""\n    try:\n        response = openai.Image.create(\n            prompt=prompt,\n            n=1,\n            size="512x512"\n        )\n        return response[\'data\'][0][\'url\']\n    except Exception as e:\n        return f"Ошибка при генерации изображения: {str(e)}"\n\ndef main():\n    """Основная функция приложения"""\n    st.title("🎭 Креативный помощник с OpenAI")\n    \n    st.sidebar.header("Настройки")\n    api_key = st.sidebar.text_input("Введите ваш OpenAI API ключ:", type="password")\n    \n    if api_key:\n        openai.api_key = api_key\n        \n        option = st.radio(\n            "Выберите тип генерации:",\n            ["📝 Сгенерировать текст", "🎨 Сгенерировать изображение", "📜 Написать стих"]\n        )\n        \n        if option == "📝 Сгенерировать текст":\n            st.subheader("Генератор текста")\n            prompt = st.text_area("Введите промпт для генерации текста:", \n                                "Напиши рассказ о путешествии во времени")\n            \n            if st.button("Сгенерировать текст"):\n                with st.spinner("Генерируем текст..."):\n                    result = generate_text(prompt)\n                    st.text_area("Результат:", result, height=300)\n        \n        elif option == "🎨 Сгенерировать изображение":\n            st.subheader("Генератор изображений")\n            prompt = st.text_input("Опишите изображение:", \n                                  "Космический кот в скафандре")\n            \n            if st.button("Сгенерировать изображение"):\n                with st.spinner("Создаем изображение..."):\n                    image_url = generate_image(prompt)\n                    \n                    if image_url.startswith("http"):\n                        st.image(image_url, caption="Сгенерированное изображение", use_column_width=True)\n                        st.success("Изображение успешно создано!")\n                    else:\n                        st.error(image_url)\n        \n        elif option == "📜 Написать стих":\n            st.subheader("Генератор стихов")\n            \n            if st.button("Написать стих про Python"):\n                with st.spinner("Сочиняем стих..."):\n                    poem = generate_poem()\n                    st.text_area("Стих:", poem, height=200)\n                    st.success("Стих готов!")\n    \n    else:\n        st.warning("⚠️ Пожалуйста, введите API ключ в боковой панели")\n        st.info("""\n        **Как получить API ключ:**\n        1. Перейдите на [OpenAI Platform](https://platform.openai.com)\n        2. Зарегистрируйтесь или войдите в аккаунт\n        3. Перейдите в раздел API Keys\n        4. Создайте новый ключ\n        """)\n\nif __name__ == "__main__":\n    main()', 'reasoning': None}], 'usage': {'prompt_tokens': 7, 'completion_tokens': 790, 'total_tokens': 797, 'prompt_tokens_details': None}}}


2025-09-11 00:55:45,773 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=25.3957s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 151, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'text'), 'msg': 'Field required', 'input': {'id': 'gen-1757541320-N2Y4R9n692GveQUJqUEA', 'provider': 'DeepInfra', 'model': 'deepseek/deepseek-chat-v3.1:free', 'object': 'chat.completion', 'created': 1757541321, 'choices': [{'logprobs': None, 'finish_reason': 'stop', 'native_finish_reason': 'stop', 'text': ', где будут упоминаться конкретные особенности языка и его философия.",\n    "temperature": 0.7,\n    "max_tokens": 150\n  },\n  "response": {\n    "id": "chatcmpl-9VqQd5u7V2UJ2wYgU7UQqJ2q2Z2X2",\n    "object": "chat.completion",\n    "created": 1716829246,\n    "model": "gpt-4-turbo-2024-04-09",\n    "choices": [\n      {\n        "index": 0,\n        "message": {\n          "role": "assistant",\n          "content": "В мире кода царит Python, красивый,\\nЧитаемость — его закон счастливый.\\nОтступы вместо скобок — вот его черта,\\nИ это программисту облегчает жизнь сполна.\\n\\n«Явное лучше неявного» — так гласит Дзен,\\nИ этому следует каждый, кто влюблён.\\nДинамическая типизация — легкость и полёт,\\nНо с строгой структурой код его живёт.\\n\\nОт простого скрипта до сложных систем\\nОн мощью своей покоряет всех совсем.\\nИ с философией «Есть только один способ»\\nОн в сердце разработчика находит путь и рос."\n        },\n        "logprobs": null,\n        "finish_reason": "stop"\n      }\n    ],\n    "usage": {\n      "prompt_tokens": 24,\n      "completion_tokens": 150,\n      "total_tokens": 174\n    },\n    "system_fingerprint": "fp_3b95652912"\n  }\n}', 'reasoning': None}], 'usage': {'prompt_tokens': 7, 'completion_tokens': 398, 'total_tokens': 405, 'prompt_tokens_details': None}}}


2025-09-11 01:02:18,061 - ERROR - UnhandledException | POST /generate | handler=post_model_prompt | time=66.5598s
Traceback:
Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/logger.py", line 32, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/api/endpoints.py", line 14, in post_model_prompt
    response = await open_router_client.post_prompt(prompt)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/openrouter/client.py", line 25, in post_prompt
    r = await self._post(url="/completions", json={
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 64, in _post
    return await self._make_request(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/app/src/services/base/client.py", line 32, in _make_request
    response = await client.request(
               ^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/arina/PycharmProjects/bic-test-repository-llm/llm-test-task/.venv/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout

2025-09-11 01:08:55,895 - INFO - OK | POST /generate | handler=post_model_prompt | time=50.0884s | status_code=200
2025-09-11 01:15:40,296 - INFO - OK | GET /docs | handler=swagger_ui_html | time=0.0002s | status_code=200
2025-09-11 01:15:40,434 - INFO - OK | GET /openapi.json | handler=openapi | time=0.0033s | status_code=200
2025-09-11 01:15:44,462 - INFO - OK | GET /models | handler=get_models_names | time=0.5164s | status_code=200
2025-09-11 01:15:45,953 - INFO - OK | GET /models | handler=get_models_names | time=0.0019s | status_code=200
2025-09-11 01:17:16,436 - INFO - OK | POST /generate | handler=post_model_prompt | time=26.6293s | status_code=200
2025-09-11 01:33:04,860 - INFO - OK | GET /docs | handler=swagger_ui_html | time=0.0004s | status_code=200
2025-09-11 01:33:05,082 - INFO - OK | GET /openapi.json | handler=openapi | time=0.0153s | status_code=200
2025-09-11 01:33:16,027 - ERROR - ClientError | POST /generate | handler=post_model_prompt | time=0.5284s

2025-09-11 01:35:36,761 - ERROR - ClientError | POST /generate | handler=post_model_prompt | time=0.5819s

2025-09-11 01:37:19,023 - ERROR - ClientError | POST /generate | handler=post_model_prompt | time=0.4594s

2025-09-11 01:39:38,347 - INFO - OK | POST /generate | handler=post_model_prompt | time=42.9548s | status_code=200
2025-09-11 01:53:11,484 - ERROR - ClientError | GET /models | handler=get_models_names | time=0.0003s

2025-09-11 01:54:50,807 - ERROR - ClientError | GET /models | handler=get_models_names | time=8.0310s

